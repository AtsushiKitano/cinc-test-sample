steps:
  - id: 'terraform init'
    name: 'hashicorp/terraform'
    args: ["init"]

  - id: 'terraform worspace select'
    name: 'hashicorp/terraform'
    args: ["workspace", "select", "$PROJECT_ID"]

  - id: 'terraform plan'
    name: 'hashicorp/terraform'
    args: ["plan"]

  - id: "inspec exec"
    name: 'cincproject/auditor'
    entrypoint: "/bin/bash"
    args:
      - -ceux
      - |
        cinc-auditor exec ./test/ -t gcp:// --input-file ./test/attributes/attribute_dev.yaml 2>&1 | tee

  - id: "make logs"
    name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: "/bin/sh"
    args: ['./test/no_gcp_lib/scripts/get_project_info.sh']

  - id: "inspec exec commands"
    name: 'cincproject/auditor'
    entrypoint: "/bin/bash"
    args:
      - -ceux
      - |
        cinc-auditor exec ./test/no_gcp_lib 2>&1 | tee

timeout: 3600s
